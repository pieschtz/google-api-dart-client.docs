        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>Utf8Decoder Class / utf Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="utf" data-type="Utf8Decoder">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../utf.html">utf</a> &rsaquo; <a href="../utf/Utf8Decoder.html">Utf8Decoder</a></div>
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>Utf8Decoder</strong>
          Class
        </h2>
        
<div class="doc">
<p>Provides an iterator of Unicode codepoints from UTF-8 encoded bytes. The
parameters can set an offset into a list of bytes (as int), limit the length
of the values to be decoded, and override the default Unicode replacement
character. Set the replacementCharacter to null to throw an
IllegalArgumentException rather than replace the bad value. The return value
from this method can be used as an Iterable (e.g. in a for-loop).</p>
</div>
<h3>Implements</h3>
<p>
<span class="type-box"><span class="icon-interface"></span><a href="../core/Iterator.html">Iterator</a></span></p>
<h3>Constructors</h3>
<div class="method"><h4 id="Utf8Decoder">
<span class="show-code">Code</span>
new <strong>Utf8Decoder</strong>._fromListRangeIterator(<a href="../utf/_ListRange.html">_ListRange</a> source, [<a href="../core/int.html">int</a> replacementCodepoint = UNICODE_REPLACEMENT_CHARACTER_CODEPOINT]) <a class="anchor-link" href="#Utf8Decoder"
              title="Permalink to Utf8Decoder.Utf8Decoder">#</a></h4>
<div class="doc">

<pre class="source">
Utf8Decoder._fromListRangeIterator(_ListRange source, [
    int this.replacementCodepoint =
    UNICODE_REPLACEMENT_CHARACTER_CODEPOINT]) :
    utf8EncodedBytesIterator = source.iterator();
</pre>
</div>
</div>
<div class="method"><h4 id="Utf8Decoder">
<span class="show-code">Code</span>
new <strong>Utf8Decoder</strong>(<a href="../core/List.html">List</a>&lt;<a href="../core/int.html">int</a>&gt; utf8EncodedBytes, [<a href="../core/int.html">int</a> offset = 0, <a href="../core/int.html">int</a> length, <a href="../core/int.html">int</a> replacementCodepoint = UNICODE_REPLACEMENT_CHARACTER_CODEPOINT]) <a class="anchor-link" href="#Utf8Decoder"
              title="Permalink to Utf8Decoder.Utf8Decoder">#</a></h4>
<div class="doc">

<pre class="source">
Utf8Decoder(List&lt;int&gt; utf8EncodedBytes, [int offset = 0, int length,
    int this.replacementCodepoint =
    UNICODE_REPLACEMENT_CHARACTER_CODEPOINT]) :
    utf8EncodedBytesIterator = (new _ListRange(utf8EncodedBytes, offset,
        length)).iterator();
</pre>
</div>
</div>
<h3>Methods</h3>
<div class="method"><h4 id="decodeRest">
<span class="show-code">Code</span>
<a href="../core/List.html">List</a>&lt;<a href="../core/int.html">int</a>&gt; <strong>decodeRest</strong>() <a class="anchor-link" href="#decodeRest"
              title="Permalink to Utf8Decoder.decodeRest">#</a></h4>
<div class="doc">
<p>Decode the remaininder of the characters in this decoder
into a [List<int>].</p>
<pre class="source">
List&lt;int&gt; decodeRest() {
  List&lt;int&gt; codepoints = new List&lt;int&gt;(utf8EncodedBytesIterator.remaining);
  int i = 0;
  while (hasNext()) {
    codepoints[i++] = next();
  }
  if (i == codepoints.length) {
    return codepoints;
  } else {
    List&lt;int&gt; truncCodepoints = new List&lt;int&gt;(i);
    truncCodepoints.setRange(0, i, codepoints);
    return truncCodepoints;
  }
}
</pre>
</div>
</div>
<div class="method"><h4 id="hasNext">
<span class="show-code">Code</span>
<a href="../core/bool.html">bool</a> <strong>hasNext</strong>() <a class="anchor-link" href="#hasNext"
              title="Permalink to Utf8Decoder.hasNext">#</a></h4>
<div class="doc">

<pre class="source">
bool hasNext() =&gt; utf8EncodedBytesIterator.hasNext();
</pre>
</div>
</div>
<div class="method"><h4 id="next">
<span class="show-code">Code</span>
<a href="../core/int.html">int</a> <strong>next</strong>() <a class="anchor-link" href="#next"
              title="Permalink to Utf8Decoder.next">#</a></h4>
<div class="doc">

<pre class="source">
int next() {
  int value = utf8EncodedBytesIterator.next();
  int additionalBytes = 0;

  if (value &lt; 0) {
    if (replacementCodepoint != null) {
      return replacementCodepoint;
    } else {
      throw new IllegalArgumentException(
          "Invalid UTF8 at ${utf8EncodedBytesIterator.position}");
    }
  } else if (value &lt;= _UTF8_ONE_BYTE_MAX) {
    return value;
  } else if (value &lt; _UTF8_FIRST_BYTE_OF_TWO_BASE) {
    if (replacementCodepoint != null) {
      return replacementCodepoint;
    } else {
      throw new IllegalArgumentException(
          "Invalid UTF8 at ${utf8EncodedBytesIterator.position}");
    }
  } else if (value &lt; _UTF8_FIRST_BYTE_OF_THREE_BASE) {
    value -= _UTF8_FIRST_BYTE_OF_TWO_BASE;
    additionalBytes = 1;
  } else if (value &lt; _UTF8_FIRST_BYTE_OF_FOUR_BASE) {
    value -= _UTF8_FIRST_BYTE_OF_THREE_BASE;
    additionalBytes = 2;
  } else if (value &lt; _UTF8_FIRST_BYTE_OF_FIVE_BASE) {
    value -= _UTF8_FIRST_BYTE_OF_FOUR_BASE;
    additionalBytes = 3;
  } else if (value &lt; _UTF8_FIRST_BYTE_OF_SIX_BASE) {
    value -= _UTF8_FIRST_BYTE_OF_FIVE_BASE;
    additionalBytes = 4;
  } else if (value &lt; _UTF8_FIRST_BYTE_BOUND_EXCL) {
    value -= _UTF8_FIRST_BYTE_OF_SIX_BASE;
    additionalBytes = 5;
  } else if (replacementCodepoint != null) {
    return replacementCodepoint;
  } else {
    throw new IllegalArgumentException(
        "Invalid UTF8 at ${utf8EncodedBytesIterator.position}");
  }
  int j = 0;
  while (j &lt; additionalBytes &amp;&amp; utf8EncodedBytesIterator.hasNext()) {
    int nextValue = utf8EncodedBytesIterator.next();
    if (nextValue &gt; _UTF8_ONE_BYTE_MAX &amp;&amp;
        nextValue &lt; _UTF8_FIRST_BYTE_OF_TWO_BASE) {
      value = ((value &lt;&lt; 6) | (nextValue &amp; _UTF8_LO_SIX_BIT_MASK));
    } else {
      // if sequence-starting code unit, reposition cursor to start here
      if (nextValue &gt;= _UTF8_FIRST_BYTE_OF_TWO_BASE) {
        utf8EncodedBytesIterator.backup();
      }
      break;
    }
    j++;
  }
  bool validSequence = (j == additionalBytes &amp;&amp; (
      value &lt; UNICODE_UTF16_RESERVED_LO ||
      value &gt; UNICODE_UTF16_RESERVED_HI));
  bool nonOverlong =
      (additionalBytes == 1 &amp;&amp; value &gt; _UTF8_ONE_BYTE_MAX) ||
      (additionalBytes == 2 &amp;&amp; value &gt; _UTF8_TWO_BYTE_MAX) ||
      (additionalBytes == 3 &amp;&amp; value &gt; _UTF8_THREE_BYTE_MAX);
  bool inRange = value &lt;= UNICODE_VALID_RANGE_MAX;
  if (validSequence &amp;&amp; nonOverlong &amp;&amp; inRange) {
    return value;
  } else if (replacementCodepoint != null) {
    return replacementCodepoint;
  } else {
    throw new IllegalArgumentException(
        "Invalid UTF8 at ${utf8EncodedBytesIterator.position - j}");
  }
}
</pre>
</div>
</div>
<h3>Fields</h3>
<div class="field"><h4 id="replacementCodepoint">
<span class="show-code">Code</span>
final <a href="../core/int.html">int</a>         <strong>replacementCodepoint</strong> <a class="anchor-link"
            href="#replacementCodepoint"
            title="Permalink to Utf8Decoder.replacementCodepoint">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final int replacementCodepoint;
</pre>
</div>
</div>
<div class="field"><h4 id="utf8EncodedBytesIterator">
<span class="show-code">Code</span>
final <a href="../utf/_ListRangeIterator.html">_ListRangeIterator</a>         <strong>utf8EncodedBytesIterator</strong> <a class="anchor-link"
            href="#utf8EncodedBytesIterator"
            title="Permalink to Utf8Decoder.utf8EncodedBytesIterator">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final _ListRangeIterator utf8EncodedBytesIterator;
</pre>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
